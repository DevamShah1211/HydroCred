<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HydroCred Test</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
</head>
<body>
    <h1>HydroCred Blockchain Test</h1>
    <div id="status">Loading...</div>
    <div id="results"></div>

    <script>
        const CONTRACT_ADDRESS = '0xa1B7a0745D37f48f7E5328E31dF4Be64b693C62d';
        const RPC_URL = 'https://eth-sepolia.g.alchemy.com/v2/demo';
        
        const adminAddress = '0x34a0eF8AC40f455C76cE7332844a55442F6e71c9';
        const newAddress = '0xd15B1985392D70cEb22d44Df0dab03425277Ce14';
        
        const contractABI = [
            'function totalSupply() view returns (uint256)',
            'function tokensOfOwner(address owner) view returns (uint256[])',
            'function ownerOf(uint256 tokenId) view returns (address)'
        ];
        
        async function testConnection() {
            try {
                document.getElementById('status').innerHTML = 'Connecting to blockchain...';
                
                // Create provider
                const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
                
                // Test basic connection
                const blockNumber = await provider.getBlockNumber();
                console.log('Current block:', blockNumber);
                
                // Create contract instance
                const contract = new ethers.Contract(CONTRACT_ADDRESS, contractABI, provider);
                
                // Test total supply
                const totalSupply = await contract.totalSupply();
                console.log('Total supply:', totalSupply.toString());
                
                // Test admin tokens
                const adminTokens = await contract.tokensOfOwner(adminAddress);
                console.log('Admin tokens:', adminTokens.map(t => Number(t)));
                
                // Test new address tokens
                const newTokens = await contract.tokensOfOwner(newAddress);
                console.log('New address tokens:', newTokens.map(t => Number(t)));
                
                // Display results
                document.getElementById('status').innerHTML = '✅ Connection successful!';
                document.getElementById('results').innerHTML = `
                    <h3>Results:</h3>
                    <p><strong>Current Block:</strong> ${blockNumber}</p>
                    <p><strong>Total Supply:</strong> ${totalSupply.toString()}</p>
                    <p><strong>Admin Tokens:</strong> [${adminTokens.map(t => Number(t)).join(', ')}]</p>
                    <p><strong>New Address Tokens:</strong> [${newTokens.map(t => Number(t)).join(', ')}]</p>
                `;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('status').innerHTML = '❌ Error: ' + error.message;
            }
        }
        
        // Run test when page loads
        testConnection();
    </script>
</body>
</html>
